<ng-container *ngIf="showToolbar">
  <app-toolbar *ngIf="!modal; else modalToolbar"
    [defaultBackHref]="$defaultBackHref|async" canGoBack="true">

    <ion-title [innerHTML]="$title|async"></ion-title>

    <!-- Help button -->
    <ion-button slot="end" (click)="reveal.toggleHelp()">
      <mat-icon slot="icon-only">help_outline</mat-icon>
    </ion-button>

    <!-- Print button -->
    <ion-button slot="end" (click)="reveal.print($event)">
      <ion-icon slot="icon-only" name="print"></ion-icon>
    </ion-button>

  </app-toolbar>

  <ng-template #modalToolbar>
    <app-modal-toolbar *ngIf="showToolbar"
                                 [modalName]="modalName"
                                 [color]="'secondary'"
                                 (cancel)="cancel()"
                                 [canValidate]="false">

      <ion-title [innerHTML]="$title|async"></ion-title>

      <!-- Print button -->
      <ion-button slot="end" (click)="reveal.print($event)">
        <ion-icon name="print"></ion-icon>
      </ion-button>

      <!-- Close button (on desktop screen) -->
      <ion-button hidden-xs hidden-sm hidden-mobile
                  slot="end"
                  (click)="cancel()"
                  (keyup.enter)="cancel()">
        <ion-label translate>COMMON.BTN_CLOSE</ion-label>
      </ion-button>
    </app-modal-toolbar>
  </ng-template>
</ng-container>

<ion-content>

  <ion-item *ngIf="error && showError" lines="none">
    <ion-icon color="danger" slot="start" name="alert-circle"></ion-icon>
    <ion-label color="danger" class="error" [innerHTML]="error|translate"></ion-label>
  </ion-item>

  <app-reveal #reveal [options]="revealOptions" *ngIf="loaded; else loadingTemplate" (slideChanged)="onSlideChanged($event)">
    <section>
      <section>
        <h1>{{ 'TRIP.REPORT.TITLE_SLIDE'|translateContext: i18nContext.suffix }}</h1>
        <ul>
          <li>{{ 'TRIP.TABLE.VESSEL'|translateContext: i18nContext.suffix }} : {{ data.vesselSnapshot.exteriorMarking }}</li>
          <li>{{ 'TRIP.DEPARTURE_DATE_TIME'|translateContext: i18nContext.suffix }} : {{ data.departureDateTime|dateFormat:{time: false} }}</li>
          <li>{{ 'TRIP.DEPARTURE_LOCATION'|translateContext: i18nContext.suffix }} : {{ data.departureLocation.name }}</li>
        </ul>
      </section>
      <section *ngFor="let c of stats.charts | keyvalue; last as last">
        <div class="chart-container">
          <canvas baseChart
                  [datasets]="c.value.data.datasets"
                  [options]="c.value.options"
                  [labels]="c.value.data.labels"
                  [colors]="c.value.colors"
                  [chartType]="c.value.type">
          </canvas>
        </div>
      </section>
      <section (entered)="!reveal.printing && showMap()">
        <h2>{{ 'TRIP.OPERATION.MAP.TITLE'|translate }}</h2>
        <!-- Operations map -->
        <div style="height: 550px;">
          <ng-container #mapContainer></ng-container>
        </div>
      </section>
    </section>

  </app-reveal>

  <ng-template #loadingTemplate>
    <div class="loader">
      <ion-spinner slot="start" color="secondary" size="large"></ion-spinner>
    </div>
  </ng-template>

</ion-content>

<ng-template #mapTemplate>
  <app-operations-map (ready)="onMapReady()"
                      [showTooltip]="false"
                      [programLabel]="data.program.label"
                      [data]="[data.operations]"
                      [flyToBoundsDelay]="0"
                      [flyToBoundsDuration]="0"
                      [showGraticule]="true"
                      [showTripTarget]="false"
                      [latLongPattern]="latLongFormat">
  </app-operations-map>
</ng-template>
