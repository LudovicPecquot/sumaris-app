<app-toolbar  *ngIf="showToolbar" [defaultBackHref]="defaultBackHref" canGoBack="true">
  <ion-title [innerHTML]="$title|async"></ion-title>
  <ion-buttons slot="end">
    <ion-button (click)="slides.print($event)" >
      <ion-icon name="print"></ion-icon>
    </ion-button>
  </ion-buttons>
</app-toolbar>

<ion-content>

  <ion-item *ngIf="error && showError" lines="none">
    <ion-icon color="danger" slot="start" name="alert-circle"></ion-icon>
    <ion-label color="danger" class="error" [innerHTML]="error|translate"></ion-label>
  </ion-item>

  <app-slides #slides *ngIf="!error" [options]="slidesOptions">
      <section>
        <ng-container *ngIf="loaded; else loadingTemplate">
          <section markdown ngPreserveWhitespaces>
            ## {{ 'OBSERVED_LOCATION.REPORT.TITLE_SHORT'|translateContext: i18nContext.suffix }}
            - {{ 'OBSERVED_LOCATION.REPORT.LOCATION'|translate }} **{{ data.location?.name }}**
            - {{ 'OBSERVED_LOCATION.REPORT.DATE_TIME'|translate }} **{{ data.startDateTime|dateFormat:{time: true} }}**
            - {{ 'OBSERVED_LOCATION.REPORT.OBSERVERS'|translate }} {{ data.observers|personToString }}

            <p markdown *ngFor="let pmfm of pmfms">
            - {{ pmfm|pmfmName:{
              i18nPrefix: i18nContext.prefix,
              i18nContext: i18nContext.suffix,
              html: true } }} : {{ data|measurementValueGet:{pmfm: pmfm, html: true} }}
            </p>

            - {{ 'OBSERVED_LOCATION.REPORT.VESSEL_COUNT'|translateContext: i18nContext.suffix }} {{ stats.vesselCount }}
          </section>
          <section markdown ngPreserveWhitespaces>
            ###
            <table>
              <thead>
                <tr>
                  <th [attr.rowspan]="2" translate>LANDING.TABLE.VESSEL</th>
                  <th *ngFor="let pmfm of landingPmfms"
                      [attr.rowspan]="isQualitativePmfm(pmfm) ? 1 : 2"
                      [attr.colspan]="isQualitativePmfm(pmfm) && pmfm.qualitativeValues?.length || 1"
                    >{{pmfm|pmfmName: {
                    i18nPrefix: i18nContext.prefix,
                    i18nContext: i18nContext.suffix,
                    html: true } }}</th>
                </tr>
                <tr>
                  <th *ngFor="let qv of (landingPmfms | arrayFilter: isQualitativePmfm | arrayPluck: {property:'qualitativeValues'}).flat()">
                    {{qv?.name}}
                  </th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let landing of data.landings">
                  <td>{{landing.vesselSnapshot?.name}}</td>
                </tr>
              </tbody>
            </table>

          </section>
        </ng-container>
      </section>

      <!-- landing reports -->
      <section *ngFor="let landing of data?.landings; index as index">
        <app-auction-control-report #landingReport
          [embedded]="true"
          [data]="landing"
          [parent]="data"
          [i18nContext]="i18nContext"
          [pmfms]="samplesPmfmsByLandingIndex[index]"
          ></app-auction-control-report>
      </section>
  </app-slides>

  <ng-template #loadingTemplate>
    <div class="loader">
      <ion-spinner slot="start" color="secondary" size="large"></ion-spinner>
    </div>
  </ng-template>

</ion-content>
